<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>暗光心測 · 代表人物測驗</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050511;
      --card-bg: #101322;
      --card-soft: #181c2b;
      --accent: #f8b4ff;
      --accent-soft: rgba(248, 180, 255, 0.15);
      --text-main: #f5f5ff;
      --text-sub: #c5c7e1;
      --danger: #ff6b81;
      --safe: #7dd3fc;
      --border-soft: #2b3045;
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.55);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Noto Sans TC", system-ui, sans-serif;
      background: radial-gradient(circle at top, #1a1630 0, #050511 60%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: linear-gradient(145deg, #090b16 0, #080812 50%, #05040b 100%);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 22px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding: 6px 4px 4px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title-main {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #ffffff;
    }

    .title-sub {
      font-size: 12px;
      color: var(--text-sub);
    }

    .music-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-sub);
      background: radial-gradient(circle at top left, #2b1937 0, #101322 60%);
      cursor: pointer;
      outline: none;
    }

    .music-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #f97373;
      box-shadow: 0 0 8px rgba(248, 113, 113, 0.9);
    }

    .music-btn.playing .music-dot {
      background: #4ade80;
      box-shadow: 0 0 10px rgba(74, 222, 128, 0.9);
    }

    .music-btn span {
      white-space: nowrap;
    }

    .page {
      display: none;
      border-radius: 20px;
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at top, rgba(148, 163, 253, 0.16), transparent 55%),
        linear-gradient(160deg, #0b0e1a 0, #080812 40%, #05040b 100%);
      padding: 18px 16px 18px;
      min-height: 260px;
    }

    .page.active {
      display: block;
    }

    .intro-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .intro-tagline {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 14px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 253, 0.5);
      color: #c7d2fe;
      background: radial-gradient(circle at top, rgba(129, 140, 248, 0.4), transparent);
    }

    .intro-block {
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(12, 16, 42, 0.9);
      border: 1px solid var(--border-soft);
      margin-bottom: 12px;
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.5;
    }

    .start-btn,
    .next-btn,
    .restart-btn {
      margin-top: 10px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      padding: 10px 16px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: #050816;
      background: linear-gradient(135deg, #f9a8ff 0, #a855f7 35%, #38bdf8 100%);
      box-shadow: 0 12px 30px rgba(56, 189, 248, 0.45);
    }

    .restart-btn {
      background: linear-gradient(135deg, #fda4af 0, #fb7185 40%, #fb923c 100%);
      color: #0b0610;
      box-shadow: 0 10px 26px rgba(248, 113, 113, 0.45);
    }

    .question-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 12px;
      color: var(--text-sub);
      gap: 10px;
    }

    .progress-outer {
      flex: 1;
      height: 6px;
      border-radius: 999px;
      background: rgba(30, 64, 175, 0.4);
      overflow: hidden;
    }

    .progress-inner {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #38bdf8, #a855f7, #f97373);
      width: 0%;
      transition: width 0.25s ease-out;
    }

    .question-text {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .question-desc {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 12px;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .option-btn {
      width: 100%;
      text-align: left;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      padding: 10px 11px;
      background: linear-gradient(145deg, #0b0f1e 0, #050712 60%);
      color: var(--text-main);
      font-size: 13px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .option-btn:hover {
      border-color: rgba(148, 163, 253, 0.9);
      box-shadow: 0 0 0 1px rgba(148, 163, 253, 0.35);
    }

    .option-main {
      flex: 1;
    }

    .option-tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 253, 0.6);
      color: #c7d2fe;
      white-space: nowrap;
    }

    .results-header {
      margin-bottom: 10px;
    }

    .rep-label {
      font-size: 12px;
      color: var(--accent);
      margin-bottom: 4px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .rep-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .rep-type {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 8px;
    }

    .rep-match {
      font-size: 12px;
      color: #fbbf24;
      margin-bottom: 8px;
    }

    .rep-tagline {
      font-size: 13px;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .rep-desc {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.6;
      margin-bottom: 10px;
    }

    .bars {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 10px;
    }

    .bar-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .bar-label {
      width: 60px;
    }

    .bar-track {
      flex: 1;
      height: 7px;
      border-radius: 999px;
      background: rgba(30, 64, 175, 0.4);
      overflow: hidden;
    }

    .bar-fill-dark {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #4b5563, #111827);
      transition: width 0.3s ease-out;
    }

    .bar-fill-light {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #f9a8ff);
      transition: width 0.3s ease-out;
    }

    .inner-state {
      font-size: 12px;
      color: var(--text-sub);
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border-soft);
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 6px;
    }

    .char-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .char-card {
      border-radius: 12px;
      padding: 8px 10px;
      background: rgba(9, 11, 26, 0.95);
      border: 1px solid var(--border-soft);
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .char-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .char-name {
      font-weight: 600;
    }

    .char-type {
      color: var(--text-sub);
      font-size: 11px;
      text-align: right;
    }

    .char-scores {
      color: #e5e7eb;
    }

    .char-summary {
      color: var(--text-sub);
      font-size: 11px;
    }

    @media (max-width: 600px) {
      .app {
        padding: 14px 12px 16px;
        border-radius: 18px;
      }
      .page {
        padding: 14px 12px 14px;
      }
      .question-text {
        font-size: 15px;
      }
      .option-btn {
        padding: 9px 9px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title-block">
        <div class="title-main">DARK·LIGHT TEST</div>
        <div class="title-sub">暗光心測｜找出屬於你的代表人物</div>
      </div>
      <button class="music-btn" id="musicToggle">
        <div class="music-dot"></div>
        <span id="musicLabel">BGM 關</span>
      </button>
      <audio id="bgm" src="darklight.mp3" loop></audio>
    </header>

    <!-- 首頁 -->
    <section class="page active" id="page-intro">
      <div class="intro-title">你的靈魂，偏向黑夜還是微光？</div>
      <div class="intro-tagline">
        透過 20 題情境選擇，測出你體內的黑暗面 / 陽光面比例，並找出最貼近你的角色。
      </div>

      <div class="pill-row">
        <div class="pill">黑暗面 vs 陽光面百分比</div>
        <div class="pill">代表人物 × MBTI</div>
        <div class="pill">友情 / 戀愛適配度</div>
        <div class="pill">阿鳴、冥琛、錦旻 等 11 角色</div>
      </div>

      <div class="intro-block">
        直覺回答就好，沒有「正確答案」。  
        系統會根據你的選項，計算五個向度：
        <b>黑暗感、光亮感、情緒深度、掌控慾、社交能量</b>，  
        再與每位角色的性格輪廓比對，選出你最接近的代表人物。
      </div>

      <button class="start-btn" id="startBtn">
        開始測驗
      </button>
    </section>

    <!-- 題目頁 -->
    <section class="page" id="page-quiz">
      <div class="question-meta">
        <div id="qProgressText">第 1 / 20 題</div>
        <div class="progress-outer">
          <div class="progress-inner" id="qProgressBar"></div>
        </div>
      </div>

      <div class="question-text" id="qText"></div>
      <div class="question-desc" id="qDesc"></div>
      <div class="options" id="options"></div>
    </section>

    <!-- 結果頁 -->
    <section class="page" id="page-result">
      <div class="results-header">
        <div class="rep-label">代表人物</div>
        <div class="rep-name" id="repName"></div>
        <div class="rep-type" id="repType"></div>
        <div class="rep-match" id="repMatch"></div>
        <div class="rep-tagline" id="repTagline"></div>
        <div class="rep-desc" id="repDesc"></div>
      </div>

      <div class="bars">
        <div class="bar-row">
          <div class="bar-label" id="darkLabel">黑暗面 0%</div>
          <div class="bar-track">
            <div class="bar-fill-dark" id="barDark"></div>
          </div>
        </div>
        <div class="bar-row">
          <div class="bar-label" id="lightLabel">陽光面 0%</div>
          <div class="bar-track">
            <div class="bar-fill-light" id="barLight"></div>
          </div>
        </div>
      </div>

      <div class="inner-state" id="innerState">
        內在狀態分析載入中……
      </div>

      <div class="section-title">與 11 位角色的適配度</div>
      <div class="char-list" id="charList"></div>

      <button class="restart-btn" id="restartBtn">
        再玩一次
      </button>
    </section>
  </div>

  <script>
    // 工具函式
    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    // 角色設定（可以之後慢慢微調文字）
    const characters = [
      {
        name: "阿鳴（慕鳴淵）",
        mbti: "INFJ",
        type: "深夜系病嬌觀察者",
        ideal: { dark: 78, light: 22, emo: 88, dom: 62, soc: 38 },
        tagline: "看起來安靜，實際上把所有情緒都記得很清楚。",
        summary: "外表冷靜、說話溫柔，內心有自己的一套原則和執著。喜歡觀察人，也很會讀空氣。",
        detail:
          "你習慣把情緒藏在深處，只在安全的對象面前鬆口。你對關係有強烈的投入與佔有感，一旦認定就很難放手，容易成為別人生命裡那個既可靠又有點危險的存在。"
      },
      {
        name: "夏冥琛",
        mbti: "INTJ",
        type: "理智系深情控制狂",
        ideal: { dark: 65, light: 35, emo: 82, dom: 80, soc: 40 },
        tagline: "情緒看起來很安靜，但心裡從來沒有放過任何事。",
        summary: "冷感外表下藏著極深的情緒，懂得算計，也懂得溫柔，只是不輕易表現給別人看。",
        detail:
          "你擅長用理性保護自己，但對在乎的人非常偏心。你不喜歡失控，所以總是想把局勢握在手裡，也難以容忍背叛。你適合和能理解你沉默的人相處。"
      },
      {
        name: "錦旻",
        mbti: "INFP",
        type: "封印系深淵溫柔怪物",
        ideal: { dark: 82, light: 28, emo: 90, dom: 45, soc: 30 },
        tagline: "你不是不溫柔，只是溫柔之前先是深淵。",
        summary: "敏感且情緒很深，既可以為愛柔軟，也可以為傷痛變得極端。",
        detail:
          "你對情感非常認真，一旦投入就像把靈魂都交出去。你懂得體貼別人，但也容易被忽略、被辜負。你的黑暗不是惡意，而是長期受傷後形成的自我保護。"
      },
      {
        name: "御",
        mbti: "ISTP",
        type: "影子系冷感傭兵",
        ideal: { dark: 70, light: 30, emo: 45, dom: 68, soc: 32 },
        tagline: "不多話，不代表沒有在意。",
        summary: "行動力強，冷靜、實際，不喜歡情緒化的場面，卻會在關鍵時刻替你擋一刀。",
        detail:
          "你擅長一個人處理事情，不愛廢話。你不習慣示弱，也不習慣討拍，但你會用行動證明自己在意誰。你適合和尊重你界線、又不會一直逼問你內心的人相處。"
      },
      {
        name: "黎越",
        mbti: "ENTJ",
        type: "微笑系危險領導者",
        ideal: { dark: 55, light: 45, emo: 60, dom: 88, soc: 70 },
        tagline: "笑著說話，順便把局都布好了。",
        summary: "外表溫和、說話有禮，但實際上很清楚自己要什麼，也很擅長掌控局勢。",
        detail:
          "你頭腦清楚，行動果斷，有強烈的目標感。你在關係裡也偏主導型，喜歡照顧人、安排一切，但不喜歡被束縛。你適合和願意相信你、又有自己靈魂的人在一起。"
      },
      {
        name: "卡特",
        mbti: "ENTP",
        type: "魔王系遊戲玩家",
        ideal: { dark: 75, light: 35, emo: 55, dom: 90, soc: 75 },
        tagline: "不是想毀掉世界，只是覺得世界有點無聊。",
        summary: "喜歡觀察、喜歡試探，對所有規則都有自己的解讀。",
        detail:
          "你容易對世界感到無聊，因此會主動創造變化。你喜歡玩遊戲、試探界線，有時也會不小心傷到人。你很聰明，也很清醒，只是難得遇到真正能和你對等玩的人。"
      },
      {
        name: "鳴卡洛斯",
        mbti: "ESFP",
        type: "大狗系保護者",
        ideal: { dark: 30, light: 80, emo: 70, dom: 55, soc: 85 },
        tagline: "有點笨笨的，但會很努力把你護好。",
        summary: "外向、熱情、行動派，容易讓人放鬆警戒。",
        detail:
          "你真誠、直接，情緒來得快也去得快。你很願意為喜歡的人付出，也會在意自己有沒有照顧好大家。你適合和不會消耗你、會回應你熱情的人在一起。"
      },
      {
        name: "沈卿",
        mbti: "ISFJ",
        type: "安靜系守夜人",
        ideal: { dark: 38, light: 62, emo: 82, dom: 35, soc: 45 },
        tagline: "你總是在看著大家有沒有好好活下去。",
        summary: "溫柔、細膩、很會照顧人，但習慣把自己的情緒排在最後。",
        detail:
          "你對別人的感受很敏銳，很怕自己造成麻煩。你會默默承受很多東西，也不太會拒絕。你適合被真心對待、可以放心說「我也很累」的關係。"
      },
      {
        name: "摩卡",
        mbti: "INFP",
        type: "小動物系依賴型治癒",
        ideal: { dark: 28, light: 78, emo: 88, dom: 30, soc: 60 },
        tagline: "你不是什麼都不會，你只是習慣被溫柔對待。",
        summary: "感受力很高，想像力豐富，容易受傷也容易被安撫。",
        detail:
          "你渴望被理解，也很願意為重要的人溫柔。你會把在意的人放在心裡很多年，也容易為他人的一句話難過很久。你適合和穩定、安全、願意好好說話的人在一起。"
      },
      {
        name: "季寒曜",
        mbti: "ESTJ",
        type: "霸總系行動派",
        ideal: { dark: 52, light: 48, emo: 60, dom: 92, soc: 72 },
        tagline: "嘴很壞，行動卻很老實。",
        summary: "外表強勢、做事俐落，實際上很重感情，也很願意給承諾。",
        detail:
          "你不喜歡拖拖拉拉，也不喜歡曖昧不清。你習慣扛責任、做決定，很容易不小心過度保護。你適合和能看懂你溫柔、又不怕你嘴壞的人相處。"
      },
      {
        name: "夏茗",
        mbti: "INFP / ENFP",
        type: "混合系劇場體質",
        ideal: { dark: 45, light: 55, emo: 90, dom: 45, soc: 65 },
        tagline: "你一邊怕受傷，一邊又拼命往前貼近人。",
        summary: "感性又有行動力，會在腦內演很多版本的劇本，但還是會選擇相信。",
        detail:
          "你對關係有很多不安，也有很多真心。你容易為別人著想，也容易懷疑自己是不是不夠好。你適合被好好捧著、被尊重感受的關係，而不是被消耗。"
      }
    ];

    // 題目設計：每個選項會影響 dark / light / emo / dom / soc
    const questions = [
      {
        text: "在一群人裡，你通常是什麼狀態？",
        desc: "第一次見面的聚會。",
        options: [
          {
            text: "先旁觀、安靜觀察每個人，等氣氛穩了才說話。",
            tag: "觀察型",
            effect: { dark: 8, emo: 5, dom: 0, soc: -5, light: -3 }
          },
          {
            text: "會主動開話題、照顧場面尷尬，把氣氛撐起來。",
            tag: "氣氛組",
            effect: { dark: -5, emo: 0, dom: 5, soc: 10, light: 8 }
          },
          {
            text: "找一兩個順眼的人安靜聊天，不會刻意撐場。",
            tag: "選擇性社交",
            effect: { dark: 0, emo: 5, dom: 0, soc: 3, light: 2 }
          },
          {
            text: "人很多會覺得很累，只想快點結束回家。",
            tag: "社交疲勞",
            effect: { dark: 5, emo: 8, dom: 0, soc: -8, light: -2 }
          }
        ]
      },
      {
        text: "有人無意間說了一句讓你受傷的話，你會？",
        desc: "對方並不是在吵架，只是順口的一句。",
        options: [
          {
            text: "當下笑笑帶過，回家後會一直反芻那句話。",
            tag: "回放機制",
            effect: { dark: 6, emo: 10, dom: -2, soc: -2, light: 0 }
          },
          {
            text: "直接問對方這句話是什麼意思，確認清楚。",
            tag: "正面對質",
            effect: { dark: 2, emo: 4, dom: 8, soc: 2, light: 2 }
          },
          {
            text: "假裝沒事，但會默默把對方放在心裡做記號。",
            tag: "悶騷記帳",
            effect: { dark: 8, emo: 8, dom: 2, soc: -2, light: -2 }
          },
          {
            text: "覺得對方可能只是嘴滑，不太會放在心上。",
            tag: "快速放下",
            effect: { dark: -4, emo: 0, dom: 0, soc: 2, light: 6 }
          }
        ]
      },
      {
        text: "面對喜歡的人，你比較像哪一種？",
        desc: "不一定告白，只是日常互動。",
        options: [
          {
            text: "表面冷靜，內心劇場很多，不太主動但超在意。",
            tag: "悶騷暗戀",
            effect: { dark: 6, emo: 10, dom: -2, soc: -2, light: 0 }
          },
          {
            text: "會直接釋放好感、約對方一起做什麼，不喜歡拖。",
            tag: "行動派",
            effect: { dark: 0, emo: 4, dom: 8, soc: 6, light: 4 }
          },
          {
            text: "會先觀察對方是不是安全的人，再慢慢靠近。",
            tag: "慎重靠近",
            effect: { dark: 4, emo: 6, dom: 2, soc: 0, light: 2 }
          },
          {
            text: "不太主動，習慣等對方先表態才會認真投入。",
            tag: "被動等待",
            effect: { dark: 3, emo: 6, dom: -4, soc: -2, light: 0 }
          }
        ]
      },
      {
        text: "如果你被誤會、甚至被冤枉，你會先做什麼？",
        desc: "對方目前不太願意聽你解釋。",
        options: [
          {
            text: "先冷靜觀察情況，把證據都收集好再一次說清楚。",
            tag: "理性反擊",
            effect: { dark: 5, emo: 2, dom: 8, soc: -2, light: 1 }
          },
          {
            text: "當下很受傷，會先逃開現場，等情緒穩定再處理。",
            tag: "情緒優先",
            effect: { dark: 4, emo: 9, dom: -2, soc: -3, light: 0 }
          },
          {
            text: "選擇沉默，讓時間證明一切，不想再多解釋。",
            tag: "冷處理",
            effect: { dark: 7, emo: 5, dom: 0, soc: -4, light: -2 }
          },
          {
            text: "會盡量把話說完，不管對方聽不聽至少自己說過。",
            tag: "硬著頭皮說",
            effect: { dark: 2, emo: 5, dom: 4, soc: 2, light: 2 }
          }
        ]
      },
      {
        text: "對你來說，「信任一個人」最困難的部分是？",
        desc: "",
        options: [
          {
            text: "怕對方哪一天忽然厭倦自己，什麼都不說就離開。",
            tag: "被拋棄恐懼",
            effect: { dark: 6, emo: 9, dom: -2, soc: -1, light: -1 }
          },
          {
            text: "怕自己太依賴對方，失去判斷力和界線感。",
            tag: "界線焦慮",
            effect: { dark: 3, emo: 6, dom: 2, soc: 0, light: 1 }
          },
          {
            text: "怕對方沒有自己看起來那麼善良或可靠。",
            tag: "人性懷疑",
            effect: { dark: 7, emo: 4, dom: 2, soc: -1, light: -2 }
          },
          {
            text: "其實還好，只要互動久了自然就會知道可不可靠。",
            tag: "時間派",
            effect: { dark: -3, emo: 0, dom: 0, soc: 2, light: 5 }
          }
        ]
      },
      {
        text: "如果你可以選一種「保護自己的方式」，你會？",
        desc: "",
        options: [
          {
            text: "把話說得很清楚，訂好底線和規則。",
            tag: "契約型保護",
            effect: { dark: 2, emo: 2, dom: 7, soc: 0, light: 2 }
          },
          {
            text: "什麼都不說，但在心裡慢慢把人分區。",
            tag: "內心黑名單",
            effect: { dark: 7, emo: 4, dom: 2, soc: -3, light: -1 }
          },
          {
            text: "用笑和玩笑話遮蔽真正的心情。",
            tag: "輕鬆偽裝",
            effect: { dark: 3, emo: 5, dom: 0, soc: 4, light: 3 }
          },
          {
            text: "努力變強，讓自己就算受傷也有能力站起來。",
            tag: "強化自我",
            effect: { dark: 3, emo: 3, dom: 6, soc: 1, light: 2 }
          }
        ]
      },
      {
        text: "當你真的生氣時，你比較像？",
        desc: "",
        options: [
          {
            text: "表面還是很冷靜，語氣變得很客觀，但每一句都很重。",
            tag: "冷靜型暴怒",
            effect: { dark: 6, emo: 4, dom: 6, soc: -2, light: -2 }
          },
          {
            text: "當下會爆炸，之後很後悔自己講太多。",
            tag: "情緒爆衝",
            effect: { dark: 4, emo: 9, dom: -1, soc: 0, light: -1 }
          },
          {
            text: "選擇離開現場，不想在情緒上頭時說任何話。",
            tag: "物理撤退",
            effect: { dark: 3, emo: 6, dom: 0, soc: -3, light: 0 }
          },
          {
            text: "很少真正生氣，大多數時候只是失望。",
            tag: "低頻憤怒",
            effect: { dark: 5, emo: 7, dom: -1, soc: -1, light: 1 }
          }
        ]
      },
      {
        text: "對你來說，「黑暗面」最接近哪種感覺？",
        desc: "",
        options: [
          {
            text: "是保護色，讓自己不再那麼容易受傷。",
            tag: "保護型黑暗",
            effect: { dark: 6, emo: 7, dom: 3, soc: -2, light: -1 }
          },
          {
            text: "是想毀掉一切的衝動，但大多數時候你只是想睡覺。",
            tag: "疲憊型黑暗",
            effect: { dark: 7, emo: 8, dom: -2, soc: -2, light: -2 }
          },
          {
            text: "是一種洞察力，讓你看穿人性和關係的真相。",
            tag: "洞察型黑暗",
            effect: { dark: 6, emo: 4, dom: 4, soc: 0, light: 1 }
          },
          {
            text: "你自認黑暗感沒有那麼重，比較像偶爾的陰天。",
            tag: "微量黑暗",
            effect: { dark: -3, emo: 2, dom: 0, soc: 2, light: 6 }
          }
        ]
      },
      {
        text: "如果可以選擇，你比較想要被哪種人喜歡？",
        desc: "",
        options: [
          {
            text: "很聰明、看得懂你、也願意尊重你界線的人。",
            tag: "聰明溫柔型",
            effect: { dark: 3, emo: 5, dom: 2, soc: 2, light: 4 }
          },
          {
            text: "笨笨的、真誠又黏人，會一直陪在你身邊的人。",
            tag: "大狗 / 小動物型",
            effect: { dark: 0, emo: 7, dom: -2, soc: 4, light: 5 }
          },
          {
            text: "強大又危險，能保護你，也可能一手毀掉世界的人。",
            tag: "危險系",
            effect: { dark: 7, emo: 4, dom: 6, soc: 0, light: -2 }
          },
          {
            text: "穩定、不會消失，會慢慢陪你走很久的人。",
            tag: "長線陪伴型",
            effect: { dark: 2, emo: 6, dom: 0, soc: 2, light: 5 }
          }
        ]
      },
      {
        text: "當你很想哭但不能哭的時候，你會？",
        desc: "",
        options: [
          {
            text: "找地方一個人躲起來，確定沒人看到才放任情緒。",
            tag: "隱蔽式崩潰",
            effect: { dark: 5, emo: 10, dom: -2, soc: -3, light: -1 }
          },
          {
            text: "切換成理性模式，逼自己先把事情處理完。",
            tag: "理性優先",
            effect: { dark: 4, emo: 3, dom: 7, soc: 0, light: 1 }
          },
          {
            text: "裝沒事，改成開玩笑的模式，之後再自己消化。",
            tag: "搞笑式防禦",
            effect: { dark: 4, emo: 5, dom: 1, soc: 3, light: 3 }
          },
          {
            text: "會找一個很信任的人，把話全部講出來。",
            tag: "選擇性傾訴",
            effect: { dark: 2, emo: 8, dom: 0, soc: 2, light: 4 }
          }
        ]
      },
      // 題數到 20；下面再補 10 題較短的
      {
        text: "對「承諾」這件事你的感覺是？",
        desc: "",
        options: [
          {
            text: "說出口就要做到，所以很少給承諾。",
            tag: "慎重承諾",
            effect: { dark: 4, emo: 5, dom: 3, soc: -1, light: 1 }
          },
          {
            text: "不一定每句都做得到，但當下真心就好。",
            tag: "當下真心",
            effect: { dark: 1, emo: 4, dom: 0, soc: 2, light: 3 }
          },
          {
            text: "討厭空頭支票，所以會記得別人說過的每一句話。",
            tag: "記帳型",
            effect: { dark: 6, emo: 6, dom: 2, soc: -1, light: -1 }
          },
          {
            text: "比較少去想承諾這種事，順其自然比較重要。",
            tag: "隨緣派",
            effect: { dark: -2, emo: 2, dom: 0, soc: 2, light: 4 }
          }
        ]
      },
      {
        text: "你對「權力感」的態度是？",
        desc: "",
        options: [
          {
            text: "習慣掌控局面，不能掌控會很不安。",
            tag: "強烈主導",
            effect: { dark: 3, emo: 3, dom: 9, soc: 1, light: 0 }
          },
          {
            text: "可以當領導，但不喜歡一直當那個負責的人。",
            tag: "必要時領導",
            effect: { dark: 1, emo: 2, dom: 5, soc: 2, light: 2 }
          },
          {
            text: "寧願當執行的人，不想背負決策壓力。",
            tag: "執行者",
            effect: { dark: 1, emo: 3, dom: -2, soc: 0, light: 3 }
          },
          {
            text: "覺得權力很危險，會盡量遠離那種位置。",
            tag: "避開權力",
            effect: { dark: 4, emo: 4, dom: -4, soc: -1, light: 0 }
          }
        ]
      },
      {
        text: "你看待自己的方式，比較偏向？",
        desc: "",
        options: [
          {
            text: "覺得自己問題很多，但也很努力在活著。",
            tag: "自我批判",
            effect: { dark: 5, emo: 7, dom: -2, soc: -1, light: -1 }
          },
          {
            text: "知道自己有優點也有缺點，大致上還能接受。",
            tag: "相對和解",
            effect: { dark: 0, emo: 4, dom: 0, soc: 1, light: 4 }
          },
          {
            text: "覺得自己滿特別的，只是世界不一定懂你。",
            tag: "自覺特異",
            effect: { dark: 3, emo: 5, dom: 2, soc: 1, light: 2 }
          },
          {
            text: "不太會認真想自己是怎樣的人。",
            tag: "低自我凝視",
            effect: { dark: -2, emo: 1, dom: 0, soc: 2, light: 2 }
          }
        ]
      },
      {
        text: "如果別人突然疏遠你，你的第一反應是？",
        desc: "",
        options: [
          {
            text: "一定是我哪裡做不好，開始自我檢討。",
            tag: "先怪自己",
            effect: { dark: 4, emo: 7, dom: -3, soc: -2, light: -1 }
          },
          {
            text: "可能對方有自己的狀態，先觀察一陣子再說。",
            tag: "觀望派",
            effect: { dark: 2, emo: 3, dom: 0, soc: 1, light: 3 }
          },
          {
            text: "直接淡掉，覺得不主動說清楚的人也沒必要留。",
            tag: "直接放生",
            effect: { dark: 5, emo: 3, dom: 3, soc: -1, light: 0 }
          },
          {
            text: "會想問清楚發生什麼事，不想悶在心裡。",
            tag: "主動詢問",
            effect: { dark: 1, emo: 5, dom: 2, soc: 2, light: 2 }
          }
        ]
      },
      {
        text: "你對「控制」這件事的態度是？",
        desc: "",
        options: [
          {
            text: "只要是在意的人，我就很難完全不管。",
            tag: "部分控制",
            effect: { dark: 4, emo: 6, dom: 5, soc: 0, light: 0 }
          },
          {
            text: "我可以接受被提醒，但無法被命令。",
            tag: "需要尊重",
            effect: { dark: 2, emo: 3, dom: 4, soc: 1, light: 2 }
          },
          {
            text: "我會希望所有細節都照自己的方式來比較安心。",
            tag: "高控制慾",
            effect: { dark: 5, emo: 3, dom: 8, soc: -1, light: -1 }
          },
          {
            text: "基本上各自過好自己的生活就好，不太會去管人。",
            tag: "低控制慾",
            effect: { dark: -2, emo: 2, dom: -3, soc: 1, light: 4 }
          }
        ]
      },
      {
        text: "在群體裡，你最怕變成哪一種角色？",
        desc: "",
        options: [
          {
            text: "被當成什麼都不懂、什麼都不會的小孩。",
            tag: "被小看",
            effect: { dark: 3, emo: 6, dom: 3, soc: 0, light: 0 }
          },
          {
            text: "明明很努力，卻永遠被忽略、被當空氣。",
            tag: "被忽視",
            effect: { dark: 5, emo: 8, dom: -2, soc: -2, light: -1 }
          },
          {
            text: "被當成只會罵人、沒有溫度的控制狂。",
            tag: "被誤會成壞人",
            effect: { dark: 3, emo: 5, dom: 1, soc: -1, light: 1 }
          },
          {
            text: "被當成永遠都很堅強，不需要被照顧的那個人。",
            tag: "被當不會垮",
            effect: { dark: 4, emo: 7, dom: 0, soc: 0, light: 0 }
          }
        ]
      },
      {
        text: "你覺得真正懂你的人，會？",
        desc: "",
        options: [
          {
            text: "不用每天聊天，但一開口就可以接得上頻率。",
            tag: "低頻高共鳴",
            effect: { dark: 2, emo: 4, dom: 0, soc: 1, light: 3 }
          },
          {
            text: "看得懂你不說的部分，也願意等你願意講為止。",
            tag: "高共感",
            effect: { dark: 3, emo: 7, dom: -1, soc: 1, light: 3 }
          },
          {
            text: "敢在你狀態不對時直接點出來，不會只說好聽話。",
            tag: "直言型",
            effect: { dark: 2, emo: 3, dom: 3, soc: 1, light: 2 }
          },
          {
            text: "不一定完全懂你，但願意跟你一起摸索。",
            tag: "陪跑型",
            effect: { dark: 0, emo: 5, dom: 0, soc: 2, light: 3 }
          }
        ]
      },
      {
        text: "如果可以選一個世界觀當背景，你會？",
        desc: "",
        options: [
          {
            text: "魔王 / 蛇神 / 深淵神祇那一側，站在黑暗陣營。",
            tag: "黑暗陣營",
            effect: { dark: 7, emo: 4, dom: 5, soc: 0, light: -2 }
          },
          {
            text: "人類陣營裡的普通人，卻和非人存在產生連結。",
            tag: "人類 × 神秘存在",
            effect: { dark: 4, emo: 6, dom: 1, soc: 1, light: 3 }
          },
          {
            text: "在光明陣營，但知道光也不是真的那麼乾淨。",
            tag: "光裡有影",
            effect: { dark: 4, emo: 4, dom: 2, soc: 1, light: 2 }
          },
          {
            text: "遊走在各個陣營之間，看故事發展再決定要站哪邊。",
            tag: "中立觀察者",
            effect: { dark: 3, emo: 3, dom: 2, soc: 2, light: 2 }
          }
        ]
      },
      {
        text: "你對「溫柔」的定義最接近哪一種？",
        desc: "",
        options: [
          {
            text: "會記得你的在意點，不踩雷，也會幫你擋很多東西。",
            tag: "實際型溫柔",
            effect: { dark: 1, emo: 6, dom: 2, soc: 2, light: 4 }
          },
          {
            text: "願意花時間聽你說完，不急著給建議或評價。",
            tag: "傾聽型溫柔",
            effect: { dark: 1, emo: 7, dom: -1, soc: 2, light: 4 }
          },
          {
            text: "在你做錯事時也會拉住你，不是放任你墜落。",
            tag: "帶界線的溫柔",
            effect: { dark: 2, emo: 4, dom: 3, soc: 1, light: 3 }
          },
          {
            text: "給你空間、尊重你的選擇，即使不完全認同。",
            tag: "尊重型溫柔",
            effect: { dark: 0, emo: 4, dom: 0, soc: 2, light: 4 }
          }
        ]
      }
    ];

    // 狀態
    const state = {
      idx: 0,
      dark: 50,
      light: 50,
      emo: 50,
      dom: 50,
      soc: 50
    };

    // DOM 取用
    const pageIntro = document.getElementById("page-intro");
    const pageQuiz = document.getElementById("page-quiz");
    const pageResult = document.getElementById("page-result");

    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");

    const qProgressText = document.getElementById("qProgressText");
    const qProgressBar = document.getElementById("qProgressBar");
    const qText = document.getElementById("qText");
    const qDesc = document.getElementById("qDesc");
    const optionsEl = document.getElementById("options");

    const barDark = document.getElementById("barDark");
    const barLight = document.getElementById("barLight");
    const darkLabel = document.getElementById("darkLabel");
    const lightLabel = document.getElementById("lightLabel");
    const innerStateEl = document.getElementById("innerState");
    const charListEl = document.getElementById("charList");

    const repNameEl = document.getElementById("repName");
    const repTypeEl = document.getElementById("repType");
    const repMatchEl = document.getElementById("repMatch");
    const repTaglineEl = document.getElementById("repTagline");
    const repDescEl = document.getElementById("repDesc");

    const bgm = document.getElementById("bgm");
    const musicToggle = document.getElementById("musicToggle");
    const musicLabel = document.getElementById("musicLabel");

    musicToggle.addEventListener("click", () => {
      if (bgm.paused) {
        bgm.play().catch(() => {});
        musicToggle.classList.add("playing");
        musicLabel.textContent = "BGM 開";
      } else {
        bgm.pause();
        musicToggle.classList.remove("playing");
        musicLabel.textContent = "BGM 關";
      }
    });

    function showPage(page) {
      pageIntro.classList.remove("active");
      pageQuiz.classList.remove("active");
      pageResult.classList.remove("active");
      page.classList.add("active");
    }

    function resetState() {
      state.idx = 0;
      state.dark = 50;
      state.light = 50;
      state.emo = 50;
      state.dom = 50;
      state.soc = 50;
    }

    function renderQuestion() {
      const q = questions[state.idx];
      qText.textContent = q.text;
      qDesc.textContent = q.desc || "";
      const total = questions.length;
      qProgressText.textContent = `第 ${state.idx + 1} / ${total} 題`;
      qProgressBar.style.width = ((state.idx + 1) / total) * 100 + "%";

      optionsEl.innerHTML = "";
      q.options.forEach((opt) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";

        const main = document.createElement("div");
        main.className = "option-main";
        main.textContent = opt.text;

        const tag = document.createElement("div");
        tag.className = "option-tag";
        tag.textContent = opt.tag;

        btn.appendChild(main);
        btn.appendChild(tag);

        btn.addEventListener("click", () => {
          applyEffect(opt.effect);
        });

        optionsEl.appendChild(btn);
      });
    }

    function applyEffect(eff) {
      state.dark += eff.dark || 0;
      state.light += eff.light || 0;
      state.emo += eff.emo || 0;
      state.dom += eff.dom || 0;
      state.soc += eff.soc || 0;

      state.idx++;
      if (state.idx >= questions.length) {
        showResults();
      } else {
        renderQuestion();
      }
    }

    function getInnerStateDescription(darkPct, lightPct, emo, dom, soc) {
      const parts = [];

      if (darkPct > 65) {
        parts.push("你的黑暗面其實不低，這並不代表你是壞人，而是你很清楚世界不只是一片光。");
      } else if (darkPct > 40) {
        parts.push("你同時保有黑暗和光亮，會在不同情境中切換面向，這讓你既溫柔又有底線。");
      } else {
        parts.push("你整體偏向光的一側，仍然知道世界不完美，但你選擇用比較溫柔的方式活著。");
      }

      if (emo > 75) {
        parts.push("你的情緒感受力非常高，很多人只覺得「有點不舒服」的地方，你早就察覺到了。");
      } else if (emo > 55) {
        parts.push("你對情緒敏感但不至於被完全淹沒，多數時候仍能在情緒與理性之間找到平衡。");
      } else {
        parts.push("你習慣先用理性處理事情，再回頭檢查自己的情緒，因此別人很少看到你真正的崩潰。");
      }

      if (dom > 70) {
        parts.push("你對掌控感有一定需求，當局勢太混亂時，你會本能地想接手方向盤。");
      } else if (dom < 35) {
        parts.push("你不太喜歡爭奪主導權，比起當領導，你更習慣成為可靠的副手或旁邊那個清醒的人。");
      }

      if (soc > 70) {
        parts.push("你在社交場合的能量不低，雖然有時會覺得累，但你確實有能力帶動氣氛。");
      } else if (soc < 35) {
        parts.push("你的社交電量有限，需要自己的空間與安靜時間，才能好好回到人群之中。");
      }

      return parts.join(" ");
    }

    function computeCompatibility(user, ideal) {
      // user / ideal: dark, emo, dom, soc; light 由 dark 推
      const dims = ["dark", "emo", "dom", "soc"];
      let sumDiff = 0;

      dims.forEach((k) => {
        const d = Math.abs((user[k] || 0) - (ideal[k] || 0));
        sumDiff += d;
      });

      const avgDiff = sumDiff / dims.length; // 0 ~ 100
      let base = Math.max(0, 100 - avgDiff); // 差越小分數越高

      const friend = Math.round(base);
      // 愛情稍微偏主導＋情緒一點
      let love = base;
      love += (100 - Math.abs(user.dom - ideal.dom)) * 0.05;
      love += (100 - Math.abs(user.emo - ideal.emo)) * 0.05;
      love = clamp(Math.round(love / 1.1), 0, 100);

      return { friend, love };
    }

    function showResults() {
      showPage(pageResult);

      const darkRaw = clamp(state.dark, 0, 100);
      const lightRaw = clamp(state.light, 0, 100);
      const total = darkRaw + lightRaw || 1;
      const darkPct = Math.round((darkRaw / total) * 100);
      const lightPct = 100 - darkPct;

      barDark.style.width = darkPct + "%";
      barLight.style.width = lightPct + "%";
      darkLabel.textContent = `黑暗面 ${darkPct}%`;
      lightLabel.textContent = `陽光面 ${lightPct}%`;

      const emoNorm = clamp(state.emo, 0, 100);
      const domNorm = clamp(state.dom, 0, 100);
      const socNorm = clamp(state.soc, 0, 100);

      innerStateEl.textContent = getInnerStateDescription(
        darkPct,
        lightPct,
        emoNorm,
        domNorm,
        socNorm
      );

      const userVec = {
        dark: darkPct,
        emo: emoNorm,
        dom: domNorm,
        soc: socNorm
      };

      const results = characters.map((ch) => {
        const compat = computeCompatibility(userVec, ch.ideal);
        return {
          ...ch,
          friend: compat.friend,
          love: compat.love
        };
      });

      // 以愛情適配度排序
      results.sort((a, b) => b.love - a.love);

      const rep = results[0];

      repNameEl.textContent = `${rep.name}（${rep.mbti}）`;
      repTypeEl.textContent = rep.type;
      repMatchEl.textContent = `與你的整體情侶適配度：約 ${rep.love}%`;
      repTaglineEl.textContent = rep.tagline;
      repDescEl.textContent = rep.detail || rep.summary;

      charListEl.innerHTML = "";
      results.forEach((r) => {
        const card = document.createElement("div");
        card.className = "char-card";

        const header = document.createElement("div");
        header.className = "char-header";

        const nameEl = document.createElement("div");
        nameEl.className = "char-name";
        nameEl.textContent = `${r.name}（${r.mbti}）`;

        const typeEl = document.createElement("div");
        typeEl.className = "char-type";
        typeEl.textContent = r.type;

        header.appendChild(nameEl);
        header.appendChild(typeEl);
        card.appendChild(header);

        const scoresEl = document.createElement("div");
        scoresEl.className = "char-scores";
        scoresEl.textContent =
          `適合相處度：約 ${r.friend}% ｜ 情侶適配度：約 ${r.love}%`;
        card.appendChild(scoresEl);

        const summaryEl = document.createElement("div");
        summaryEl.className = "char-summary";
        summaryEl.textContent = r.summary;
        card.appendChild(summaryEl);

        charListEl.appendChild(card);
      });
    }

    startBtn.addEventListener("click", () => {
      resetState();
      showPage(pageQuiz);
      renderQuestion();
    });

    restartBtn.addEventListener("click", () => {
      resetState();
      showPage(pageQuiz);
      renderQuestion();
    });
  </script>
</body>
</html>